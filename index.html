<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/12308/12308603.png">
    
    <title>LifeOS v53</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #000000;
            --glass: rgba(20, 20, 25, 0.9);
            --border: rgba(255, 255, 255, 0.1);
            --primary: #00f0ff;
            --accent: #7000ff;
            --success: #00ff9d;
            --danger: #ff0055;
            --text: #ffffff;
            --text-dim: #8b9bb4;
            --font: 'Outfit', sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
        
        body { 
            margin: 0; font-family: var(--font); background: var(--bg); color: var(--text); 
            height: 100vh; height: 100dvh; /* Altura real m√≥vil */
            overflow: hidden; display: flex; flex-direction: column;
        }

        /* FONDO */
        .bg-orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.3; z-index: -1; animation: float 20s infinite alternate; }
        .orb-1 { top: -20%; left: -20%; width: 80vw; height: 80vw; background: var(--accent); }
        .orb-2 { bottom: -20%; right: -20%; width: 80vw; height: 80vw; background: var(--primary); }
        @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(20px,40px); } }

        /* SCROLL CONTAINER (FIX CR√çTICO) */
        #app-view { 
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden;
            padding: 20px;
            scroll-behavior: smooth; 
            -webkit-overflow-scrolling: touch;
            position: relative;
            z-index: 1;
        }
        
        /* ESPACIADOR GIGANTE PARA QUE NADA SE TAPE */
        .spacer-bottom { height: 180px; width: 100%; display: block; }

        .view { display: none; opacity: 0; animation: fadeIn 0.3s forwards; }
        .view.active { display: block; }
        @keyframes fadeIn { to { opacity: 1; } }

        /* CARDS */
        .card { 
            background: var(--glass); border: 1px solid var(--border); border-radius: 24px; 
            padding: 20px; margin-bottom: 15px; position: relative; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h2 { font-size: 26px; margin: 0; font-weight: 800; }
        
        /* BOTONES */
        .btn { 
            background: var(--primary); color: #000; border: none; padding: 14px; 
            border-radius: 14px; font-weight: 700; width: 100%; font-size: 15px; 
            display: flex; justify-content: center; align-items: center; gap: 8px; 
            cursor: pointer; transition: 0.2s;
        }
        .btn:active { transform: scale(0.96); }
        .btn.glass { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid var(--border); }
        .btn.ai { background: linear-gradient(135deg, var(--accent), #b000ff); color: white; }
        .btn.danger { background: rgba(255, 0, 85, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .btn.success { background: rgba(0, 255, 157, 0.15); color: var(--success); border: 1px solid var(--success); }
        .btn-sm { padding: 8px 12px; font-size: 12px; width: auto; border-radius: 10px; }
        .btn-icon { background: none; border: none; font-size: 1.2rem; padding: 5px; width: auto; color: var(--text-dim); }

        input, textarea, select { 
            background: rgba(0,0,0,0.3); border: 1px solid var(--border); 
            color: white; padding: 14px; border-radius: 14px; width: 100%; margin-bottom: 10px;
            font-family: var(--font); font-size: 16px;
        }

        /* CHECKBOXES */
        .check-row { display: flex; align-items: center; gap: 12px; padding: 14px; background: rgba(255,255,255,0.03); border-radius: 16px; margin-bottom: 8px; cursor: pointer; border: 1px solid transparent; }
        .check-row.done { opacity: 0.5; border-color: rgba(255,255,255,0.05); }
        .box { width: 22px; height: 22px; border: 2px solid var(--text-dim); border-radius: 6px; display: grid; place-items: center; }
        .check-row.done .box { background: var(--success); border-color: var(--success); }
        .check-row.done .box::after { content: '‚úì'; color: #000; font-weight: 900; }

        /* NUTRICION */
        .water-vis { display: flex; align-items: center; gap: 20px; }
        .cup { width: 60px; height: 100px; border: 3px solid rgba(255,255,255,0.2); border-top: none; border-radius: 0 0 25px 25px; overflow: hidden; background: rgba(255,255,255,0.02); position: relative; }
        .cup-fill { position: absolute; bottom: 0; width: 100%; background: linear-gradient(to top, #0066cc, #00d2ff); height: 0%; transition: 0.5s; opacity: 0.9; }
        
        .macro-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .macro-card { background: rgba(255,255,255,0.03); border-radius: 14px; padding: 10px 5px; display: flex; flex-direction: column; align-items: center; }
        .ring-svg { width: 45px; height: 45px; transform: rotate(-90deg); }
        .ring-svg circle { fill: none; stroke-width: 5; }
        .ring-bg { stroke: rgba(255,255,255,0.1); }
        .ring-prog { stroke-dasharray: 100; stroke-dashoffset: 100; transition: 1s; stroke-linecap: round; }

        /* DOCK (Men√∫ Inferior) */
        .dock {
            position: fixed; bottom: 20px; left: 15px; right: 15px;
            background: rgba(10, 10, 12, 0.95); backdrop-filter: blur(20px);
            border: 1px solid var(--border); border-radius: 30px;
            padding: 10px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px;
            z-index: 1000; box-shadow: 0 10px 40px #000;
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 50px; color: #666; transition: 0.2s; border-radius: 15px; }
        .nav-item.active { color: #fff; background: rgba(255,255,255,0.08); }
        .nav-icon { font-size: 20px; margin-bottom: 2px; }
        .nav-label { font-size: 9px; font-weight: 700; letter-spacing: 0.5px; }

        /* ZEN */
        .zen-circle { width: 160px; height: 160px; border-radius: 50%; background: radial-gradient(var(--accent), transparent 70%); margin: 20px auto; opacity: 0.3; transform: scale(1); display: flex; align-items: center; justify-content: center; flex-direction: column; border: 2px solid rgba(255,255,255,0.1); transition: 4s; }
        .zen-circle.inhale { transform: scale(1.5); opacity: 0.9; background: radial-gradient(var(--primary), transparent 60%); border-color: var(--primary); }
        .zen-circle.hold { transform: scale(1.5); opacity: 0.9; border-color: #fff; }
        .zen-circle.exhale { transform: scale(1); opacity: 0.4; border-color: rgba(255,255,255,0.2); }
        #zen-text { font-size: 20px; font-weight: 900; letter-spacing: 2px; color: #fff; text-shadow: 0 0 10px black; }

        /* MODALS */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal.open { display: flex; }
        .modal-box { background: #151515; border: 1px solid #333; padding: 25px; border-radius: 24px; width: 90%; max-width: 320px; max-height: 80vh; overflow-y: auto; }

        /* WIZARD */
        .step { display: none; animation: slide 0.3s; }
        .step.active { display: block; }
        @keyframes slide { from { opacity:0; transform: translateX(20px); } to { opacity:1; transform: translateX(0); } }
        .opt-btn { padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 8px; cursor: pointer; border: 1px solid transparent; }
        
        .loader { width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.2); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>

    <div id="view-home" class="view active">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h2 style="margin:0;">LifeOS</h2>
            <button class="btn glass btn-sm" onclick="openModal('install-modal')" style="border-color:var(--primary); color:var(--primary);">üì≤ Instalar</button>
        </div>

        <div class="card">
            <h3>H√°bitos</h3>
            <div id="habits-list">
                <div class="check-row" id="h-sleep" onclick="toggleHabit('sleep')"><div class="box"></div><span>üò¥ Dormir 8 Horas</span></div>
                <div class="check-row" id="h-eat" onclick="toggleHabit('eat')"><div class="box"></div><span>ü•ó Comer Bien</span></div>
                <div class="check-row" id="h-water" onclick="toggleHabit('water')"><div class="box"></div><span>üíß Cumplir Agua</span></div>
            </div>
        </div>

        <div class="card" style="border-left: 4px solid var(--danger);">
            <h3>üî• Objetivo</h3>
            <div id="urgent-list"></div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <input type="text" id="urgent-inp" placeholder="Escribe aqu√≠..." style="margin:0;">
                <button class="btn danger" style="width:auto;" onclick="addUrgent()">+</button>
            </div>
        </div>

        <div class="card">
            <h3>üß† Brain Dump</h3>
            <input type="text" id="dump-inp" placeholder="Libera tu mente..." onkeypress="if(event.key==='Enter') addDump()">
            <div id="dump-list" style="margin-top:10px;"></div>
        </div>
        
        <div class="spacer-bottom"></div>
    </div>

    <div id="view-gym" class="view">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h2>Gym AI</h2>
            <button class="btn glass btn-sm" onclick="resetGym()">Reset</button>
        </div>
        
        <div id="gym-wizard">
            <div id="gs-1" class="step active">
                <div class="card">
                    <h3>Objetivo</h3>
                    <div class="opt-btn" onclick="setGym('goal','Hipertrofia',2)">üí™ Ganar M√∫sculo</div>
                    <div class="opt-btn" onclick="setGym('goal','Definici√≥n',2)">üî• Perder Grasa</div>
                    <div class="opt-btn" onclick="setGym('goal','Fuerza',2)">üèãÔ∏è Fuerza</div>
                </div>
            </div>
            <div id="gs-2" class="step">
                <div class="card">
                    <h3>Equipo</h3>
                    <div class="opt-btn" onclick="setGym('equip','Gym Completo',3)">üè¢ Gimnasio</div>
                    <div class="opt-btn" onclick="setGym('equip','Mancuernas',3)">üè† Mancuernas</div>
                    <div class="opt-btn" onclick="setGym('equip','Calistenia',3)">üå≥ Peso Corporal</div>
                    <button class="btn glass btn-sm" onclick="gymStep(1)" style="margin-top:10px;">Atr√°s</button>
                </div>
            </div>
            <div id="gs-3" class="step">
                <div class="card">
                    <h3>Frecuencia</h3>
                    <div class="opt-btn" onclick="setGymFreq(3,4)">3 D√≠as</div>
                    <div class="opt-btn" onclick="setGymFreq(4,4)">4 D√≠as</div>
                    <div class="opt-btn" onclick="setGymFreq(5,4)">5 D√≠as</div>
                    <div class="opt-btn" onclick="setGymFreq(6,4)">6 D√≠as</div>
                    <button class="btn glass btn-sm" onclick="gymStep(2)" style="margin-top:10px;">Atr√°s</button>
                </div>
            </div>
            <div id="gs-4" class="step">
                <div class="card">
                    <h3>Generar</h3>
                    <input type="number" id="gym-weight" placeholder="Peso (kg)">
                    <button class="btn ai" id="btn-gen-gym" onclick="genRoutine()">‚ú® Crear Rutina</button>
                    <button class="btn glass btn-sm" onclick="gymStep(3)" style="margin-top:10px;">Atr√°s</button>
                </div>
            </div>
        </div>

        <div id="gym-dash" style="display:none;">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3 id="gym-title" style="color:var(--primary); margin:0;">D√≠a 1</h3>
                    <div>
                        <button class="btn glass btn-sm" onclick="gymDay(-1)">‚ùÆ</button>
                        <button class="btn glass btn-sm" onclick="gymDay(1)">‚ùØ</button>
                    </div>
                </div>
                <div id="gym-list"></div>
                <div style="margin-top:20px;">
                    <button class="btn success" onclick="alert('¬°Sesi√≥n Cumplida!')">Terminar Sesi√≥n</button>
                </div>
            </div>
        </div>
        <div class="spacer-bottom"></div>
    </div>

    <div id="view-food" class="view">
        <h2 style="margin-bottom:15px;">Nutrici√≥n</h2>
        
        <div id="nutri-wizard">
            <div class="card">
                <h3>Configuraci√≥n</h3>
                <label>Objetivo</label>
                <select id="nutri-goal"><option>Perder Grasa</option><option>Mantener</option><option>Ganar M√∫sculo</option></select>
                <label>Peso (kg)</label>
                <input type="number" id="nutri-weight">
                <button class="btn ai" id="btn-gen-nutri" onclick="genNutriPlan()">‚ú® Calcular IA</button>
            </div>
        </div>

        <div id="nutri-dash" style="display:none;">
            <div class="card">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                    <h3 style="margin:0;">Diario</h3>
                    <button class="btn glass btn-sm" onclick="openModal('macros-modal')">Editar</button>
                </div>
                <div style="text-align:center; margin-bottom:10px;">
                    <h1 style="margin:0; font-size:36px;"><span id="cal-curr">0</span> <span style="font-size:14px; color:#888;">kcal</span></h1>
                </div>
                <div class="macro-grid">
                    <div class="macro-card">
                        <div class="ring-wrapper"><svg class="ring-svg"><circle class="ring-bg" cx="22.5" cy="22.5" r="18"/><circle id="ring-prot" class="ring-prog" cx="22.5" cy="22.5" r="18" style="stroke:var(--danger);"/></svg></div>
                        <div style="font-size:10px;">PROT</div><div style="font-weight:700; font-size:12px;" id="txt-prot">0g</div>
                    </div>
                    <div class="macro-card">
                        <div class="ring-wrapper"><svg class="ring-svg"><circle class="ring-bg" cx="22.5" cy="22.5" r="18"/><circle id="ring-carb" class="ring-prog" cx="22.5" cy="22.5" r="18" style="stroke:var(--primary);"/></svg></div>
                        <div style="font-size:10px;">CARB</div><div style="font-weight:700; font-size:12px;" id="txt-carb">0g</div>
                    </div>
                    <div class="macro-card">
                        <div class="ring-wrapper"><svg class="ring-svg"><circle class="ring-bg" cx="22.5" cy="22.5" r="18"/><circle id="ring-fat" class="ring-prog" cx="22.5" cy="22.5" r="18" style="stroke:var(--warning);"/></svg></div>
                        <div style="font-size:10px;">GRASA</div><div style="font-weight:700; font-size:12px;" id="txt-fat">0g</div>
                    </div>
                </div>
            </div>

            <div class="card" style="display:flex; align-items:center; gap:20px;">
                <div class="cup" onclick="openModal('water-modal')"><div class="cup-fill" id="water-fill"></div></div>
                <div style="flex:1;">
                    <div style="display:flex; justify-content:space-between;">
                        <h3 style="margin:0;">Agua</h3><button class="btn-icon" onclick="openModal('water-modal')">‚úèÔ∏è</button>
                    </div>
                    <h2 style="font-size:28px; margin:0;"><span id="w-curr">0.0</span>L</h2>
                    <div style="display:flex; gap:8px; margin-top:5px;">
                        <button class="btn glass btn-sm" onclick="addWater(0.25)">+250</button>
                        <button class="btn glass btn-sm" onclick="addWater(0.5)">+500</button>
                    </div>
                </div>
            </div>

            <div class="card" style="border:1px solid rgba(112, 0, 255, 0.3);">
                <h3>Registro IA</h3>
                <input type="file" id="f-img" style="display:none;" onchange="handleImage(this)">
                <button class="btn glass" id="btn-foto" onclick="document.getElementById('f-img').click()" style="padding:20px; border-style:dashed; margin-bottom:10px;">üì∏ Toca para foto</button>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="f-txt" placeholder="O escribe..." style="margin:0;">
                    <button class="btn ai" id="btn-food-ai" style="width:auto;" onclick="analyzeFood()">‚ú®</button>
                </div>
            </div>
            <div id="food-log"></div>
            <button class="btn danger" onclick="resetNutri()" style="margin-top:20px;">Reiniciar</button>
        </div>
        <div class="spacer-bottom"></div>
    </div>

    <div id="view-work" class="view">
        <h2>Oficina</h2>
        <div class="card" style="border:1px solid var(--danger); background:rgba(255,0,85,0.05);">
            <button class="btn danger" onclick="openModal('panic-modal')">üö® BOT√ìN DE P√ÅNICO</button>
        </div>
        <div class="card">
            <h3>Bit√°cora</h3>
            <input type="text" id="meet-title" placeholder="T√≠tulo...">
            <textarea id="meet-notes" rows="3" placeholder="Notas..."></textarea>
            <button class="btn glass" onclick="saveMeet()">Guardar</button>
        </div>
        <div id="meet-list"></div>
        <div class="spacer-bottom"></div>
    </div>

    <div id="view-focus" class="view">
        <h2>Focus</h2>
        <div class="card" style="text-align:center;">
            <h3>Pomodoro</h3>
            <h1 id="pomo-timer" style="font-size:60px; font-weight:800; margin:10px 0;">25:00</h1>
            <button class="btn" id="btn-pomo" onclick="togglePomo()">Iniciar</button>
        </div>
        <div class="card" style="text-align:center;">
            <h3>Modo Zen (4-4-4-4)</h3>
            <div class="zen-circle" id="zen-circle">
                <div id="zen-text">ZEN</div>
            </div>
            <div id="zen-timer-total" style="margin-top:15px; color:var(--text-dim);">5:00</div>
            <input type="range" min="1" max="30" value="5" oninput="updZen(this.value)" style="width:60%; margin-top:5px;">
            <button class="btn glass" id="btn-zen" style="margin-top:15px;" onclick="toggleZen()">Comenzar</button>
        </div>
        <div class="spacer-bottom"></div>
    </div>

    <div id="view-plan" class="view">
        <h2>Agenda</h2>
        <div class="card">
            <h3>Nuevo</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input type="date" id="cal-date">
                <input type="time" id="cal-time">
            </div>
            <input type="text" id="cal-txt" placeholder="Evento...">
            <button class="btn glass" onclick="addEvent()">Agendar</button>
            <div id="cal-list" style="margin-top:15px;"></div>
        </div>
        <div class="spacer-bottom"></div>
    </div>

    <div id="view-life" class="view">
        <h2>Vida</h2>
        <div class="card">
            <div style="display:flex; justify-content:space-between;">
                <h3>Ahorro</h3>
                <button class="btn-icon" onclick="openModal('money-modal')">üéØ</button>
            </div>
            <h2 style="font-size:36px; color:var(--success);">$<span id="fin-curr">0</span></h2>
            <div style="display:flex; gap:8px; margin-top:10px;">
                <button class="btn glass" onclick="addMoney(50)">+50</button>
                <button class="btn glass" onclick="addMoney(100)">+100</button>
            </div>
        </div>
        <div class="card">
            <h3>Detox</h3>
            <h2 id="detox-val" style="text-align:center; font-size:36px; margin:5px 0;">0</h2>
            <div style="display:flex; gap:10px;">
                <button class="btn glass" onclick="addDetox(10)">+10m</button>
                <button class="btn danger" onclick="addDetox(-10)">-10m</button>
            </div>
        </div>
        <div class="spacer-bottom"></div>
    </div>

    <div id="view-settings" class="view">
        <h2>Ajustes</h2>
        <div class="card">
            <label style="font-size:12px; color:var(--text-dim);">API Key</label>
            <input type="text" id="api-key">
            <button class="btn" onclick="saveKeys()">Guardar</button>
        </div>
        <div class="card">
            <h3>üì≤ C√≥mo Instalar App</h3>
            <button class="btn success" onclick="openModal('install-modal')">Ver Gu√≠a</button>
        </div>
        <button class="btn danger" onclick="if(confirm('¬øBorrar TODO?')){localStorage.clear();location.reload();}">Reset F√°brica</button>
        <div class="spacer-bottom"></div>
    </div>

    <div id="install-modal" class="modal"><div class="modal-box">
        <h3>Instalaci√≥n Manual</h3>
        <p style="font-size:14px; margin-bottom:15px; line-height:1.4;">Al ser una app privada, debes agregarla manualmente:</p>
        <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-bottom:10px;">
            <strong style="color:var(--primary);">Android (Chrome):</strong><br>
            1. Toca los 3 puntos (arriba ‚ÜóÔ∏è)<br>
            2. "Agregar a pantalla principal"
        </div>
        <div style="background:rgba(255,255,255,0.05); padding:10px; border-radius:10px; margin-bottom:15px;">
            <strong style="color:var(--accent);">iPhone (Safari):</strong><br>
            1. Bot√≥n Compartir (abajo ‚¨ÜÔ∏è)<br>
            2. "Agregar a Inicio"
        </div>
        <button class="btn glass" onclick="closeModal('install-modal')">Entendido</button>
    </div></div>

    <div id="water-modal" class="modal"><div class="modal-box">
        <h3>Agua</h3>
        <label>Meta (L)</label><input type="number" id="m-w-goal">
        <label>Manual (L)</label><input type="number" id="m-w-add">
        <button class="btn success" onclick="saveWaterModal()">Guardar</button>
        <button class="btn glass" style="margin-top:10px" onclick="closeModal('water-modal')">Cerrar</button>
    </div></div>

    <div id="macros-modal" class="modal"><div class="modal-box">
        <h3>Metas</h3>
        <label>Kcal</label><input type="number" id="m-cal">
        <label>Prot</label><input type="number" id="m-prot">
        <label>Carb</label><input type="number" id="m-carb">
        <label>Fat</label><input type="number" id="m-fat">
        <button class="btn ai" onclick="saveMacrosModal()">Guardar</button>
        <button class="btn glass" style="margin-top:10px" onclick="closeModal('macros-modal')">Cerrar</button>
    </div></div>

    <div id="money-modal" class="modal"><div class="modal-box">
        <h3>Meta Ahorro</h3>
        <input type="number" id="m-money-goal" placeholder="Total...">
        <button class="btn success" onclick="setMoneyGoal()">Fijar</button>
        <button class="btn glass" style="margin-top:10px" onclick="closeModal('money-modal')">Cerrar</button>
    </div></div>

    <div id="panic-modal" class="modal" style="background:rgba(20,0,0,0.95);"><div class="modal-box" style="border:1px solid red;">
        <h2 style="color:red; text-align:center;">‚ö†Ô∏è SCRIPT</h2>
        <p style="font-size:20px; text-align:center;">"Perd√≥n, se cort√≥ un poco mi audio. ¬øPodr√≠as repetir el √∫ltimo punto?"</p>
        <button class="btn glass" onclick="closeModal('panic-modal')">Cerrar</button>
    </div></div>

    <div class="dock">
        <div class="nav-item" onclick="nav('home',this)"><div class="nav-icon">üè†</div><span class="nav-label">INICIO</span></div>
        <div class="nav-item" onclick="nav('gym',this)"><div class="nav-icon">üí™</div><span class="nav-label">GYM</span></div>
        <div class="nav-item" onclick="nav('food',this)"><div class="nav-icon">üçé</div><span class="nav-label">NUTRI</span></div>
        <div class="nav-item" onclick="nav('work',this)"><div class="nav-icon">üíº</div><span class="nav-label">WORK</span></div>
        <div class="nav-item" onclick="nav('focus',this)"><div class="nav-icon">üß†</div><span class="nav-label">FOCUS</span></div>
        <div class="nav-item" onclick="nav('plan',this)"><div class="nav-icon">üìÖ</div><span class="nav-label">PLAN</span></div>
        <div class="nav-item" onclick="nav('life',this)"><div class="nav-icon">üíé</div><span class="nav-label">VIDA</span></div>
        <div class="nav-item" onclick="nav('settings',this)"><div class="nav-icon">‚öôÔ∏è</div><span class="nav-label">SET</span></div>
    </div>

    <script>
        const MODEL = 'gemini-2.5-flash-lite';
        const KEY_DEFAULT = 'AIzaSyBpGMRC_FCAGIP_S436VMWmq3jiePgBh20';
        
        let DB = {
            habits: {sleep:false, eat:false, water:false},
            urgent: [], dumps: [], sched: [], meetings: [],
            food: { active:false, water:0, waterGoal:3, log:[], daily:{cal:0,prot:0,carb:0,fat:0}, goals:{cal:2000,prot:150,carb:200,fat:60} },
            gym: { active:false, config:{}, routine:[], day:0 },
            pomo: { log:[] }, life: { fin:0, finMeta:1000, detox:0 },
            key: KEY_DEFAULT
        };

        const aud = new (window.AudioContext||window.webkitAudioContext)();
        function beep(){try{const o=aud.createOscillator();const g=aud.createGain();o.frequency.value=600;o.connect(g);g.connect(aud.destination);o.start();g.gain.exponentialRampToValueAtTime(0.0001,aud.currentTime+0.5);o.stop(aud.currentTime+0.5);}catch(e){}}

        function init() {
            const s=localStorage.getItem('lifeos_v53'); if(s) Object.assign(DB, JSON.parse(s));
            if(typeof DB.habits!=='object') DB.habits={sleep:false,eat:false,water:false};
            
            const today = new Date().toDateString();
            if(localStorage.getItem('lifeos_date') !== today) {
                DB.food.water=0; DB.food.daily={cal:0,prot:0,carb:0,fat:0}; DB.food.log=[];
                DB.habits={sleep:false, eat:false, water:false}; DB.life.detox=0;
                localStorage.setItem('lifeos_date', today);
            }
            document.getElementById('api-key').value = DB.key;
            renderAll(); nav('home');
        }

        function save(){ localStorage.setItem('lifeos_v53', JSON.stringify(DB)); }
        function renderAll(){ renderHome(); renderGym(); renderFood(); renderWork(); renderPlan(); renderLife(); }
        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            if(el){ document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active')); el.classList.add('active'); }
        }
        function saveKeys(){DB.key=document.getElementById('api-key').value; save(); alert("Guardado");}
        function openModal(id){document.getElementById(id).classList.add('open');}
        function closeModal(id){document.getElementById(id).classList.remove('open');}

        // HOME
        function toggleHabit(id){ DB.habits[id]=!DB.habits[id]; save(); renderHome(); beep(); }
        function addUrgent(){ const v=document.getElementById('urgent-inp').value; if(v){DB.urgent.push(v); document.getElementById('urgent-inp').value=''; save(); renderHome();} }
        function addDump(){ const v=document.getElementById('dump-inp').value; if(v){DB.dumps.unshift(v); document.getElementById('dump-inp').value=''; save(); renderHome();} }
        function renderHome(){
            ['sleep','eat','water'].forEach(h=>{ 
                const el = document.getElementById('h-'+h);
                if(DB.habits[h]) el.classList.add('done'); else el.classList.remove('done');
            });
            document.getElementById('urgent-list').innerHTML = DB.urgent.map((t,i)=>`<div class="check-row" onclick="DB.urgent.splice(${i},1);save();renderHome()"><div class="box"></div><span>${t}</span></div>`).join('');
            document.getElementById('dump-list').innerHTML = DB.dumps.map((t,i)=>`<div style="font-size:12px; padding:8px 0; border-bottom:1px solid rgba(255,255,255,0.1);">${t} <span style="float:right;color:#ff5555" onclick="DB.dumps.splice(${i},1);save();renderHome()">‚úï</span></div>`).join('');
        }

        // GYM
        function setGym(k,v,n){ DB.gym.config[k]=v; gymStep(n); }
        function setGymFreq(v,n){ DB.gym.config.freq=v; gymStep(n); }
        function gymStep(n){ document.querySelectorAll('.wizard-step').forEach(s=>s.classList.remove('active')); document.getElementById('gs-'+n).classList.add('active'); }
        
        async function genRoutine(){
            const w = document.getElementById('gym-weight').value;
            const btn = document.getElementById('btn-gen-gym');
            btn.innerHTML = '‚è≥ Calculando...'; btn.disabled=true;
            
            const prompt = `Act√∫a como entrenador. Rutina de 60-90 min para: ${DB.gym.config.goal}, ${DB.gym.config.equip}, ${DB.gym.config.freq} d√≠as/sem. Peso: ${w}kg.
            RESPONDE SOLO JSON: [{"day":"D√≠a 1: Pecho","exercises":["Press Banca 4x10","Aperturas 3x12"]}]`;
            
            try {
                const res = await callAI(prompt);
                const clean = res.replace(/```json|```/g,'').trim();
                DB.gym.routine = JSON.parse(clean);
                DB.gym.active = true; DB.gym.day = 0;
                save(); renderGym();
            } catch(e) { alert("Error IA"); }
            btn.innerHTML = '‚ú® Crear Rutina'; btn.disabled=false;
        }
        
        function renderGym(){
            if(!DB.gym.active) { document.getElementById('gym-wizard').style.display='block'; document.getElementById('gym-dash').style.display='none'; gymStep(1); return; }
            document.getElementById('gym-wizard').style.display='none'; document.getElementById('gym-dash').style.display='block';
            
            const d = DB.gym.routine[DB.gym.day];
            document.getElementById('gym-title').innerText = d.day;
            document.getElementById('gym-list').innerHTML = d.exercises.map(e => {
                let txt = e;
                if(typeof e === 'object') {
                    txt = e.name || e.exercise || e.txt || JSON.stringify(e);
                    if(e.sets && e.reps) txt += ` (${e.sets}x${e.reps})`;
                }
                return `<div class="check-row" onclick="this.classList.toggle('done')"><div class="box"></div><span>${txt}</span></div>`;
            }).join('');
        }
        function gymDay(d){
            let next = DB.gym.day + d;
            if(next >= 0 && next < DB.gym.routine.length) { DB.gym.day = next; save(); renderGym(); }
        }
        function resetGym(){ if(confirm("¬øBorrar?")){ DB.gym.active=false; save(); renderGym(); } }

        // FOOD
        async function genNutriPlan(){
            const goal = document.getElementById('nutri-goal').value;
            const w = document.getElementById('nutri-weight').value;
            const btn = document.getElementById('btn-gen-nutri');
            
            if(!w) return alert("Ingresa tu peso");
            btn.innerHTML = '‚è≥ Calculando...'; btn.disabled=true;

            const prompt = `Act√∫a como nutricionista. Calcula macros diarios para: Objetivo ${goal}, Peso ${w}kg.
            RESPONDE SOLO JSON: {"cal": 2000, "prot": 160, "carb": 200, "fat": 60}`;

            try {
                const res = await callAI(prompt);
                const clean = res.replace(/```json|```/g,'').trim();
                DB.food.goals = JSON.parse(clean);
                DB.food.active = true;
                save(); renderFood();
            } catch(e) { alert("Error IA"); }
            btn.innerHTML = '‚ú® Calcular Macros IA'; btn.disabled=false;
        }

        function addWater(l){ DB.food.water += l; save(); renderFood(); }
        function saveWaterModal(){
            const m = parseFloat(document.getElementById('m-w-goal').value);
            const a = parseFloat(document.getElementById('m-w-add').value);
            if(m) DB.food.waterGoal = m;
            if(a) DB.food.water += a;
            closeModal('water-modal'); save(); renderFood();
        }
        function saveMacrosModal(){
            DB.food.goals.cal = parseFloat(document.getElementById('m-cal').value);
            DB.food.goals.prot = parseFloat(document.getElementById('m-prot').value);
            DB.food.goals.carb = parseFloat(document.getElementById('m-carb').value);
            DB.food.goals.fat = parseFloat(document.getElementById('m-fat').value);
            closeModal('macros-modal'); save(); renderFood();
        }
        
        let img64 = null;
        function handleImage(i){ 
            if(i.files[0]) {
                const r = new FileReader(); 
                r.onload=()=>{
                    img64=r.result.split(',')[1]; 
                    const btn = document.getElementById('btn-foto');
                    btn.innerText="Imagen Lista ‚úÖ";
                    btn.style.borderColor = 'var(--success)';
                }; 
                r.readAsDataURL(i.files[0]); i.value = '';
            }
        }
        
        async function analyzeFood(){
            const txt = document.getElementById('f-txt').value;
            const btn = document.getElementById('btn-food-ai');
            if(!txt && !img64) return alert("Falta info");
            
            btn.innerHTML = '‚è≥'; btn.disabled=true;
            try {
                const res = await callAI(`Analiza: "${txt}". JSON SOLO (sin markdown): {"name":"Plato","cal":0,"prot":0,"carb":0,"fat":0}`, img64);
                const d = JSON.parse(res.replace(/```json|```/g,'').trim());
                
                DB.food.daily.cal += d.cal || 0; 
                DB.food.daily.prot += d.prot || 0; 
                DB.food.daily.carb += d.carb || 0; 
                DB.food.daily.fat += d.fat || 0;
                DB.food.log.unshift(d);
                
                save(); renderFood(); 
                img64=null; document.getElementById('f-txt').value=''; 
                const btnF = document.getElementById('btn-foto');
                btnF.innerText="üì∏ Toca para foto"; btnF.style.borderColor='rgba(255,255,255,0.1)';
            } catch(e) { alert("Error IA: " + e.message); }
            btn.innerText = "‚ú®"; btn.disabled=false;
        }

        function renderFood(){
            if(!DB.food.active) {
                document.getElementById('nutri-wizard').style.display = 'block';
                document.getElementById('nutri-dash').style.display = 'none';
                return;
            }
            document.getElementById('nutri-wizard').style.display = 'none';
            document.getElementById('nutri-dash').style.display = 'block';

            const wPct = Math.min((DB.food.water / DB.food.waterGoal)*100, 100);
            document.querySelector('.cup-fill').style.height = wPct + "%";
            document.getElementById('w-curr').innerText = DB.food.water.toFixed(1);
            
            document.getElementById('cal-curr').innerText = DB.food.daily.cal;
            
            ['prot','carb','fat'].forEach(m => {
                const val = DB.food.daily[m] || 0;
                const goal = DB.food.goals[m] || 1; 
                const pct = Math.min((val/goal)*100, 100);
                const offset = 100 - pct;
                document.getElementById('ring-'+m).style.strokeDashoffset = offset;
                document.getElementById('txt-'+m).innerText = val+'/'+goal+'g';
                
                if(document.getElementById('m-'+m)) document.getElementById('m-'+m).value = goal;
            });
            document.getElementById('m-cal').value = DB.food.goals.cal;

            document.getElementById('food-log').innerHTML = DB.food.log.map(l=>`<div style="font-size:13px; padding:10px; border-bottom:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between;"><span>${l.name}</span><span>${l.cal} kcal</span></div>`).join('');
        }
        function resetNutri(){ if(confirm("¬øBorrar metas?")){ DB.food.active=false; save(); renderFood(); } }

        // ZEN
        let zTmr, zTime=5; 
        function updZen(v){ zTime=v; document.getElementById('zen-timer-total').innerText = v+":00"; }
        function toggleZen(){
            const c = document.getElementById('zen-circle');
            const b = document.getElementById('btn-zen');
            const t = document.getElementById('zen-text');
            
            if(zTmr) { 
                clearInterval(zTmr); zTmr=null; 
                c.className='zen-circle'; t.innerText="ZEN"; b.innerText="Comenzar"; 
            } else {
                b.innerText="Detener";
                let totalSec = zTime * 60;
                let phaseSec = 0; 
                
                const cycle = () => {
                    const p = Math.floor(phaseSec / 4) % 4; 
                    c.className = 'zen-circle ' + (p===0?'inhale': p===1?'hold': p===2?'exhale':'hold-out');
                    t.innerText = (p===0?'INHALA': p===1?'SOST√âN': p===2?'EXHALA':'SOST√âN');
                    
                    phaseSec++;
                    totalSec--;
                    
                    const m = Math.floor(totalSec/60); const s = totalSec%60;
                    document.getElementById('zen-timer-total').innerText = `${m}:${s<10?'0'+s:s}`;

                    if(totalSec<=0) { clearInterval(zTmr); beep(); toggleZen(); alert("Sesi√≥n terminada"); }
                };
                
                cycle(); 
                zTmr = setInterval(cycle, 1000);
            }
        }
        
        let pTmr, pTime=1500;
        function togglePomo(){
            const b = document.getElementById('btn-pomo');
            if(pTmr) { clearInterval(pTmr); pTmr=null; b.innerText="Iniciar"; }
            else {
                b.innerText="Pausar";
                pTmr = setInterval(()=>{
                    pTime--;
                    const m = Math.floor(pTime/60).toString().padStart(2,'0');
                    const s = (pTime%60).toString().padStart(2,'0');
                    document.getElementById('pomo-timer').innerText = `${m}:${s}`;
                    if(pTime<=0) { clearInterval(pTmr); beep(); alert("¬°Tiempo!"); pTime=1500; save(); }
                },1000);
            }
        }

        // EXTRAS
        function saveMeet(){ const t=document.getElementById('meet-title').value; const n=document.getElementById('meet-notes').value; if(t){DB.work.unshift({t,n}); save(); renderWork();} }
        function renderWork(){ document.getElementById('meet-list').innerHTML=DB.work.map(w=>`<div class="card" style="padding:15px;"><b>${w.t}</b><p style="font-size:13px;color:#aaa;margin-top:5px;">${w.n}</p></div>`).join(''); }
        function addMoney(v){ DB.life.fin+=v; save(); renderLife(); }
        function setMoneyGoal(){ const v=document.getElementById('m-money-goal').value; if(v){ DB.life.finMeta=parseFloat(v); closeModal('money-modal'); save(); renderLife(); } }
        function addDetox(v){ DB.life.detox+=v; if(DB.life.detox<0)DB.life.detox=0; save(); renderLife(); }
        function renderLife(){ document.getElementById('fin-curr').innerText=DB.life.fin + ' / ' + (DB.life.finMeta||1000); document.getElementById('detox-val').innerText=DB.life.detox; }
        
        function addEvent(){ 
            const d=document.getElementById('cal-date').value; const t=document.getElementById('cal-time').value; const x=document.getElementById('cal-txt').value;
            if(x){ DB.sched.push({d,t,x}); save(); renderPlan(); }
        }
        function renderPlan(){
            DB.sched.sort((a,b)=>new Date(a.d)-new Date(b.d));
            document.getElementById('cal-list').innerHTML=DB.sched.map(e=>`<div class="check-row"><b>${e.d} ${e.t}</b> ${e.x}</div>`).join('');
        }

        async function callAI(text, img) {
            const body = { contents: [{ parts: [{ text }] }] };
            if(img) body.contents[0].parts.push({ inline_data: { mime_type: "image/jpeg", data: img } });
            const r = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${DB.key}`, {
                method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body)
            });
            const res = await r.json();
            if(res.error) throw new Error(res.error.message);
            return res.candidates[0].content.parts[0].text;
        }

        init();
    </script>
</body>
</html>